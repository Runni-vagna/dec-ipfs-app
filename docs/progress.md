# Progress Log

## 2026-02-19

- Initialized repository scaffold from `AGENTS.md`.
- Created monorepo layout: `packages/core`, `packages/ui`, `packages/tauri`.
- Added baseline governance docs and risk register.
- Implemented Phase 0 runnable baseline:
  - `packages/ui` migrated to React 19 + Vite + Tailwind + PWA manifest/service worker.
  - Dark glassmorphic desktop/mobile shell aligned to inspiration references.
  - `packages/tauri` wired with Tauri 2 config to host UI dev/build output.
- Validation status:
  - `pnpm install`: pass
  - `pnpm --filter @cidfeed/ui build`: pass
  - `pnpm typecheck`: pass
  - `pnpm build`: blocked only at `@cidfeed/tauri` due missing `javascriptcoregtk-4.1`/`webkit2gtk-4.1` system libs in current runtime.
- CI added:
  - `.github/workflows/ci.yml` created with two jobs:
    - workspace checks (`typecheck`, `@cidfeed/core build`, `@cidfeed/ui build`)
    - Linux Tauri build with WebKitGTK dependencies installed on runner
- CI hardening (after first public run):
  - expanded Linux Tauri dependency install list (`build-essential`, `pkg-config`, `libssl-dev`, `libglib2.0-dev`, `libxdo-dev`)
  - added `tauri-build.log` artifact upload (`if: always()`) for actionable failure diagnostics
- Integrated shared feed-domain utilities from `packages/core` into the UI publish flow:
  - added deterministic local CID generation utility in `packages/core/src/index.ts`
  - added draft-post builder aligned with feed entry schema v1.1
  - wired `packages/ui/src/App.tsx` compose publish action to use core-generated CID + timestamp instead of ad-hoc UI-only IDs
  - expanded core test coverage to include CID generation and draft-post creation
- Validation status (latest):
  - `pnpm test`: pass
  - `pnpm typecheck`: pass
- Added first UI -> Tauri command bridge for private-node controls:
  - new UI adapter: `packages/ui/src/tauri-private-node.ts` (web fallback + Tauri invoke path)
  - wired private-node start/stop/status/peer-join controls in `packages/ui/src/App.tsx`
  - implemented Tauri command handlers + shared in-memory state in `packages/tauri/src-tauri/src/main.rs`
  - pinned UI dependency: `@tauri-apps/api` for command invocation
- Runtime caveat (local environment): Tauri Rust build/check still requires Linux WebKitGTK/JSC system packages (`webkit2gtk-4.1`, `javascriptcoregtk-4.1`) before full native compile can pass.
- Consolidated feed interaction logic into shared core domain helpers:
  - added reusable operations in `packages/core/src/index.ts` for post conversion, prepend, filter, remove/restore, and boolean flag toggles
  - updated UI feed actions in `packages/ui/src/App.tsx` to call core helpers for publish/filter/pin/follow/remove/undo
  - expanded core tests to cover these flows (`9` tests passing in core suite)
- Consolidated profile-state import/export/reset logic into core domain helpers:
  - added active-tab parsing + feed UI state/snapshot helpers in `packages/core/src/index.ts`
  - added strict JSON import parser with fallback behavior for invalid or empty post payloads
  - updated `packages/ui/src/App.tsx` profile tools to call shared core state helpers instead of direct UI JSON handling
  - expanded core tests for snapshot serialization and import/reset behavior (`12` tests passing in core suite)
- Added persistent private-node runtime state in Tauri shell:
  - `packages/tauri/src-tauri/src/main.rs` now loads initial private-node state from app data (`private-node-state.json`)
  - start/stop/peer-join commands persist updated state to disk after each mutation
  - app startup restores previous node online/peer count values for UI status sync
- Wired wizard onboarding modes to real Tauri command paths:
  - added `start_private_node_mode` command in `packages/tauri/src-tauri/src/main.rs` with strict mode validation (`easy`/`private`)
  - extended `packages/ui/src/tauri-private-node.ts` with mode-aware invoke helper
  - updated wizard "Quick Start" and "Finish & Start Node" in `packages/ui/src/App.tsx` to call mode-specific node start command with web fallback
- Added Phase 1 identity foundation (local DID scaffold):
  - implemented DID-key identity utilities in `packages/core/src/index.ts` (create/validate/serialize/parse/format)
  - wired profile UI identity actions in `packages/ui/src/App.tsx` (`Create DID`, `Clear DID`) with local persistence
  - expanded core tests for identity helpers and UI tests for profile DID creation flow
- Added Phase 1 UCAN + revocation scaffolding in core:
  - implemented UCAN delegation model with bounded TTL, expiry checks, revocation ID generation, and strict parse/serialize helpers in `packages/core/src/index.ts`
  - added offline revocation queue primitives (enqueue + parse/serialize) for reconnect replay flows
  - expanded core tests to cover delegation creation/parsing, expiry behavior, invalid payload handling, and revocation queue behavior (`19` core tests passing)
  - documented security impact in `docs/threat-model.md` under UCAN scaffold status
- Wired UCAN lifecycle controls into profile UI:
  - added local persistence state keys for active UCAN delegation + offline revocation queue in `packages/ui/src/App.tsx`
  - profile actions now support `Create UCAN` (delegation with explicit expiry) and `Revoke UCAN` (enqueue offline revocation entry + clear active delegation)
  - profile panel now shows UCAN active/expired status, expiry timestamp, and queued revocation count
  - expanded UI interactions tests to cover UCAN create/revoke flow (`5` UI tests passing)
- Added offline revocation replay flow:
  - added `replayOfflineRevocations` batch helper in `packages/core/src/index.ts`
  - wired `Replay Revocations` profile action in `packages/ui/src/App.tsx` to drain queue and report replay count
  - expanded core and UI tests to cover replay behavior (`20` core tests passing; `5` UI tests passing)
- Migrated identity/UCAN/revocation persistence to Tauri app-data bridge:
  - added `get_security_state` / `set_security_state` commands in `packages/tauri/src-tauri/src/main.rs` with persisted `security-state.json`
  - added UI Tauri bridge module `packages/ui/src/tauri-security-state.ts`
  - updated `packages/ui/src/App.tsx` to hydrate security state from Tauri on startup and persist updates to both Tauri storage and local fallback storage
- Added UCAN expiry safety UX + auto-revoke queueing:
  - core now exposes remaining-time/expiring-soon helpers for delegations
  - profile panel now surfaces `UCAN Expiring Soon` status before expiry
  - expired delegations are automatically queued for offline revocation replay and cleared from active delegation state
- Added Tauri revocation flush command path:
  - implemented `flush_revocation_queue` command stub in `packages/tauri/src-tauri/src/main.rs`
  - extended UI bridge (`packages/ui/src/tauri-security-state.ts`) with flush command client
  - replay action in `packages/ui/src/App.tsx` now calls Tauri flush in desktop mode and keeps web fallback behavior
- Added persistent security audit trail:
  - implemented core audit helpers for create/append/parse/serialize in `packages/core/src/index.ts`
  - extended Tauri security state payload to persist audit log JSON alongside identity/UCAN/revocation data
  - wired `packages/ui/src/App.tsx` to record and display security events (`identity.*`, `ucan.*`, `revocation.replayed`) in profile view
  - expanded tests to validate audit helpers and UI audit rendering (`22` core tests passing; `5` UI tests passing)
- Added audit-log management UX in profile:
  - security audit panel now supports filters (`All`, `Identity`, `UCAN`, `Revocations`)
  - added `Export Audit` and `Clear Audit` actions in profile tools
  - expanded UI tests for audit clearing flow (`6` UI tests passing)
- Improved revocation flush result handling:
  - Tauri `flush_revocation_queue` now returns per-item result groups (`flushedIds`, `failedIds`)
  - UI replay action now reports both success and failure counts in status + audit event detail
- Added audit exploration controls:
  - profile security audit panel now supports text search across event + detail fields
  - added chronological sort controls (`Newest` / `Oldest`) for audit entries
  - expanded UI interaction tests for audit search behavior (`7` UI tests passing)
- Added audit entry detail inspection:
  - audit rows are now clickable and open a dedicated detail modal with event/detail/timestamp/id
  - modal supports escape/overlay close behavior consistent with existing dialogs
  - expanded UI interactions tests for audit detail open/close flow (`8` UI tests passing)
- Added failed-flush retry queue with backoff metadata:
  - added core retry helpers in `packages/core/src/index.ts` (`upsert`, `remove`, `split-ready`, parse/serialize)
  - extended Tauri security-state payload persistence with `failed_flush_queue_json` in `packages/tauri/src-tauri/src/main.rs`
  - wired UI retry queue state + persistence in `packages/ui/src/App.tsx` and `packages/ui/src/tauri-security-state.ts`
  - replay flow now moves failed flush IDs into retry metadata and adds `Retry Failed Flushes` action to re-queue ready retries
  - expanded core tests for retry helper coverage in `packages/core/tests/create-feed-entry.test.ts`
- Validation status (current environment):
  - `pnpm test`: blocked (`env: 'node': No such file or directory`)
  - `pnpm typecheck`: blocked (`env: 'node': No such file or directory`)
- Added UI regression coverage for failed retry queue action:
  - `packages/ui/tests/app.interactions.test.tsx` now validates `Retry Failed Flushes` re-queues ready retries and replay drains the queue
- Added UCAN revocation-list verification path:
  - added revocation-list model + helpers in `packages/core/src/index.ts` (create, add-entry, parse/serialize, listed-check, delegation verification)
  - expanded core tests in `packages/core/tests/create-feed-entry.test.ts` for revocation-list verification outcomes
  - wired revocation-list persistence through Tauri security state (`packages/tauri/src-tauri/src/main.rs`, `packages/ui/src/tauri-security-state.ts`)
  - updated profile UI in `packages/ui/src/App.tsx` with delegation verification indicator (`UCAN Active/Expiring Soon/Expired/Revoked`)
  - added profile actions: `Verify UCAN`, `Mark Revoked`, `Clear Revocation List`
  - added UI test coverage for revoked-status rendering in `packages/ui/tests/app.interactions.test.tsx`
- Enforced delegation status during compose publish:
  - `packages/ui/src/App.tsx` now blocks publishing when delegation verification resolves to `revoked` or `expired`
  - blocked publish path records `ucan.verified` audit event and user-facing status message
  - added UI test for revoked publish block in `packages/ui/tests/app.interactions.test.tsx`
- Added revocation-list integrity signing scaffolding:
  - extended core revocation-list schema with `issuerDid` and `signature` in `packages/core/src/index.ts`
  - added core helpers `signRevocationList` and `verifyRevocationListSignature`
  - added core tests for signed/tampered revocation-list verification behavior
  - profile UI now shows revocation-list integrity state and includes `Sign Revocation List` / `Verify Revocation List` actions
  - added UI test that signs an unverified list and verifies status changes to `Verified`
- Added issuer trust policy for revocation-list verification:
  - added core policy helpers in `packages/core/src/index.ts`: trusted DID list parse/serialize, issuer trust check, and policy verification (`valid` / `untrusted-issuer` / `invalid-signature`)
  - expanded core tests for trust-policy outcomes and trusted DID list parsing
  - extended Tauri security-state schema with `trusted_revocation_issuers_json`
  - wired UI persistence + profile controls for `Trust Issuer` / `Untrust Issuer`
  - profile now displays revocation-list policy status and UI tests cover policy transition to `valid` after trusting issuer
- Added offline replay risk visibility:
  - profile now includes a `Security Warnings` panel in `packages/ui/src/App.tsx` for invalid revocation signatures, untrusted issuers, failed flush retries, and replay backlog
  - expanded UI tests to cover invalid revocation signature warning path in `packages/ui/tests/app.interactions.test.tsx`
  - updated `risk-register.md` and `docs/risk-register.md` with R6-R8 replay/trust/tamper risks and mitigations
- Added retry backoff visualization in profile:
  - profile now includes `Retry Backoff` summary with severity (`low`/`medium`/`high`), next retry window, max retry count, and next retry timestamp
  - warning messages now include backoff severity and next retry window context
  - expanded UI tests for ready-now retry backoff rendering
- Added automatic high-backoff escalation banner:
  - profile now includes an `Escalation` panel that activates when high backoff severity persists for repeated intervals
  - high-severity streak counter is persisted in local storage (`cidfeed.ui.retryHighStreak`) and reset when risk clears
  - expanded UI tests for escalation banner rendering on persisted high-backoff streak
- Added escalation acknowledgement flow:
  - profile escalation panel now includes `Acknowledge Escalation` action
  - acknowledgement timestamp is persisted (`cidfeed.ui.retryEscalationAcknowledgedAt`) while escalation remains active
  - acknowledgement emits `revocation.verified` audit entry and user-facing status message
  - expanded UI tests for escalation acknowledgement and audit rendering
- Added unsafe replay confirmation gate:
  - `Replay Revocations` now requires explicit second-click confirmation when revocation list policy is not `valid`
  - first click logs `revocation.verified` event and shows a blocking safety message with current policy status
  - expanded UI tests for unsafe replay confirmation flow
- Added `Safe Replay Only` hard gate:
  - profile now exposes `Safe Replay Only: On/Off` toggle persisted in local storage (`cidfeed.ui.safeReplayOnly`)
  - when enabled, unsafe replay (`invalid-signature` / `untrusted-issuer`) is denied with no confirmation bypass
  - expanded UI tests to verify unsafe replay remains blocked while safe replay mode is enabled

### Phase Tracking

- Phase 0: In progress
- Next checkpoint: confirm GitHub Actions green on both jobs, then run local `pnpm dev:tauri` on host desktop for manual Phase 0 sign-off.
